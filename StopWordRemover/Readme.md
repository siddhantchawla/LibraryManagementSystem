This is a solution to the problem defined here: https://gist.github.com/charleyslee/457a7c249d38b5e2d60932e6eb443964